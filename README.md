# Writing your first Django app, part 1

- Create a basic **poll application**.
- Two parts:
  1. Public site - View polls and vote.
  2. Admin site - Add, change, and delete polls.

## Creating a project (environment)

- Initial setup - bootstrap a Django project - generate settings:
  - Database configuration
  - Django-specific options
  - Application-specific settings
- Command to bootstrap a new Django project:
  ```bash
  projects/ 
  $ django-admin startproject mysite djangotutorial
  ```
- **Note:** Avoid naming projects after built-in Python or Django components (packages).
- Generated files:
  File | Description
  -----|------------
  `manage.py` | Command-line utility for interacting with the Django project.
  `mysite/` | **Main Python package** for the Django project.
  `mysite/urls.py` | URL declarations. A **"table of contents"** of the Django powered site.
  `mysite/asgi.py` | Entry-point for **ASGI-compatible web servers**.
  `mysite/wsgi.py` | Entry-point for **WSGI-compatible web servers**.

## The development server

- Command to start the **development server**.
  ```bash
  projects/djangotutorial 
  $ python manage.py runserver
  ```
- **Don't** use this server in production.
- **Auto reloading** for code changes (adding files don't trigger a restart). 

## Creating the Polls app

- Projects vs. apps
  - An **app** is a **web application** (e.g. poll app)
  - A **project** is  **a collection of configuration and apps** for a particular website.
- Command to create an app:
  ```bash
  projects/djangotutorial 
  $ python manage.py startapp polls
  ```

## Write your first view

- Implement the view in `polls/views.py`.
- Define a URL configuration (**URLconf**) **inside the Django app** to map a view to a URL.
  - Create the `polls/urls.py` file.
- Next, **configure the global URLconf** in the `mysite` project **to include** the URLconf defined in `polls.urls`.
  - `django.urls.include()`
    - Allows referencing **other URLconf**.
    - To **plug-and-play URLs**.
    - Always use `include()` to include other URL patterns.

# Writing your first Django app, part 2

## Database setup

- In `mysite/settings.py`
  - While at it, set `TIME_ZONE` to your time zone.
  - **By default**, a Django project activate several `INSTALLED_APPS` as a convenience for the common case. Some require **database tables to be setup**. To do that, run:
    ```bash
    $ python manage.py migrate
    ```
- **By default**, Django uses **SQLite**.

## Creating models

- Philosophy:
  - A model is the **definitive source** of info about your data.
  - The goal is to define your data model in one place and derive things (e.g. migration) from it. (Data/model-driven)
- Each **model** is defined as a **subclass** of `django.db.models.Model`.
- Each **field** (class variable) is an **instance of** a `Field` class.

## Activating models

- Create a Python database-access API.
- First, install the `polls` app in the project.
  - Add a reference to its configuration class in the `INSTALL_APPS` setting.
- Command to create migrations:
  ```bash
  $ python manage.py makemigrations polls
  ```
- Command to print the **SQLs** to be used in the migration.
  ```bash
  $ python manage.py sqlmigrate polls 0001
  ```
- **Three steps** in making model changes:
  1. Change your models (in `models.py`)
  2. Create migrations for changes - `python manage.py makemigrations`
  3. Apply changes to the database - `python manage.py migrate`

## Playing with the API

- `__str__()` are used throughout Django's autogenerated admin.
- Some ORM API examples:
  ```py
  from polls.models import Choice, Question

  # Query all
  Question.objects.all()

  # Insert
  from django.utils import timezone
  q = Question(question_text="What's new?", pub_date=timezone.now())
  q.save()
  q.id  # ID is returned.

  # Update
  q.question_text = "What's up?"
  q.save()

  # Get/Filter
  #   Identical to Question.objects.get(id=1)
  q = Question.objects.get(pk=1)
  #   Filter returns a collection.
  Question.objects.filter(id=1)
  #   Use double underscores to perform attribute lookups.
  Question.objects.filter(question_text__startswith="What")
  Choice.objects.filter(question__pub_date__year=current_year)

  # Working with related objects (one to many relationship).
  q.choice_set.all()  # Query
  q.choice_set.count()
  #   Create a related object.
  q.choice_set.create(choice_text="Not much", votes=0)

  # Delete
  c = q.choice_set.filter(choice_text__startswith="Just hacking")
  c.delete()
  ```

## Introducing the Django Admin

- Philosophy:
  - Automates creation of admin site for models.
  - Has a **clear separation** between "content publishers" and the "public" site.
  - Admin site is for site managers to edit content.

### Creating an admin user

- Command to create a **admin site user**:
  ```bash
  $ python manage.py createsuperuser 
  ```
- To make models modifiable in the admin site, register models in the admin module of the app, `polls/admin.py`.
